# vim: ft=python sts=2 ts=2 sw=0 tw=99 et
import os

protoc = builder.DetectProtoc()
protoc.includes += ['.']

proto_files = [
  'history.proto',
  'model.proto',
  'poll.proto',
  'state.proto',
  'cache.proto',
]

proto_gen = protoc.Generate(builder, proto_files, ['cpp', 'python'])

protos = builder.cxx.StaticLibrary('protos')
protos.compiler.sourcedeps += proto_gen['cpp']['sources']
protos.compiler.sourcedeps += proto_gen['cpp']['headers']
for src_entry in proto_gen['cpp']['sources']:
  src_path = os.path.join(builder.buildPath, src_entry.path)
  protos.sources.append(src_path)

Global.libprotos = builder.Add(protos)

rvalue = proto_gen
